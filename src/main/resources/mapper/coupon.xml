<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.dodam.hotel.repository.interfaces.CouponRepository">

	<!-- 쿠폰 등록 -->
	<insert id="insert">
		INSERT INTO coupon_tb (name, content, user_id,
		start_date, end_date)
		VALUES ('1박 무료 숙박 쿠폰', '멤버쉽 회원이 되신걸 환영합니다! ', #{userId}, date_format(now(),
		'%Y-%m-%d'), date_add(start_date, INTERVAL 1 YEAR));
	</insert>
	
	<resultMap type="com.dodam.hotel.repository.model.Coupon" id="Coupon">
		<result column="id" property="id"/>
		<result column="name" property="name"/>
		<result column="content" property="content"/>
		<result column="start_date" property="startDate"/>
		<result column="end_date" property="endDate"/>
		<collection property="user" resultMap="User"></collection>
	</resultMap>
	
	<resultMap type="com.dodam.hotel.repository.model.User" id="User">
		<result column="id" property="id"/>
		<result column="email" property="email"/>
		<result column="password" property="password"/>
		<result column="name" property="name"/>
		<result column="gender" property="gender"/>
		<result column="birth" property="birth"/>
		<result column="tel" property="tel"/>
		<result column="blacklist" property="blacklist"/>
		<result column="withdrawal" property="withdrawal"/>
		<result column="created_at" property="createdAt"/>
	</resultMap>
	
	<!-- 특정 회원 쿠폰 조회 -->
	<select id="findByUserId" resultMap="Coupon">
		select *
		from coupon_tb
		where user_id = #{userId}
	</select>
	
</mapper>